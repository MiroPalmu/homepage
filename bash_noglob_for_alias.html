<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Journey of disabling filename expansion for Bash alias &#8212; Miro Palmu&#39;s homepage</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=d45e8c67"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  
   
  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <section id="journey-of-disabling-filename-expansion-for-bash-alias">
<h1>Journey of disabling filename expansion for Bash alias<a class="headerlink" href="#journey-of-disabling-filename-expansion-for-bash-alias" title="Link to this heading">¶</a></h1>
<p>I wanted to disable Bash pathname expansion for my Bash alias:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;git&#39;</span>
</pre></div>
</div>
<p>As expected I found solution from <a class="reference external" href="https://stackoverflow.com/a/22945024">Stackoverflow</a>,
so I modified my alias to be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>consume_noglob<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">command</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span>
<span class="w">    </span><span class="nv">$command</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">set</span><span class="w"> </span>+o<span class="w"> </span>noglob
<span class="o">}</span>
<span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;set -o noglob; consume_noglob git&#39;</span>
</pre></div>
</div>
<p>However this solution fails to work with pipes. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;commit message&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>g<span class="w"> </span>commit<span class="w"> </span>-F<span class="w"> </span>-
</pre></div>
</div>
<p>will be equivalent to:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;commit message&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>noglob<span class="p">;</span><span class="w"> </span>consume_noglob<span class="w"> </span>git
</pre></div>
</div>
<p>which means, as pipes have higher precedence over list separators,
the commit message will be piped to <code class="code docutils literal notranslate"><span class="pre">set</span></code>
insted of to <code class="code docutils literal notranslate"><span class="pre">git</span></code> inside <code class="code docutils literal notranslate"><span class="pre">consume_noglob</span></code>.</p>
<p>To solve this problem, I had plan to do following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;&lt;stash_pipe_cmd&gt;; set -o noglob; &lt;pop_pipe_stash_cmd&gt; | consume_noglob git&#39;</span>
</pre></div>
</div>
<p>where <cite>&lt;stash_pipe_cmd&gt;</cite> would store the piped data sowhere
and then <cite>&lt;pop_pope_stash_cmd&gt;</cite> could pipe it to git.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the follwing discussion enviroment variable <cite>__pipestashdir</cite> contains
path to directory which can be used as runtime directory <a class="footnote-reference brackets" href="#rundir" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
</div>
<p>In my first impelemntation of <cite>&lt;stash_pipe_cmd&gt;</cite> and <cite>&lt;pop_pipe_stash_cmd&gt;</cite>,
I naively thought that I could just use <code class="code docutils literal notranslate"><span class="pre">cat</span></code> and Bash redirections:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;stash_pipe_cmd&gt;</span>
<span class="k">function</span><span class="w"> </span>pstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Use $1 as the name for the stash.</span>
<span class="w">    </span>cat<span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># &lt;pop_pipe_stash_cmd&gt;</span>
<span class="k">function</span><span class="w"> </span>ppstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">stashname</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># No stash exits, so do nothing.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>cat<span class="w">  </span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>With this solution</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;commit message&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>g<span class="w"> </span>commit<span class="w"> </span>-F<span class="w"> </span>-
</pre></div>
</div>
<p>seems to work, but if the alias is used on its own it will hang:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>g<span class="w"> </span>--version
</pre></div>
</div>
<p>as cat will read until EOF and stdin is connected to terminal.
In <code class="code docutils literal notranslate"><span class="pre">pstash</span></code> this can be checked and only use <code class="code docutils literal notranslate"><span class="pre">cat</span></code> if it is not:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>pstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">stashname</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span><span class="w"> </span><span class="c1"># Override current potential unused stash</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-t<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># stdin is connected to terminal,</span>
<span class="w">        </span><span class="c1"># so there is nothing to read.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>cat<span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now alias:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;pstash galias; set -o noglob; ppstash galias | consume_noglob git&#39;</span>
</pre></div>
</div>
<p>will be usable in pipes and everything is good…,
only there is one problem, git’s interactive adding:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>g<span class="w"> </span>add<span class="w"> </span>-i
</pre></div>
</div>
<p>will exit immediatly. This is because, apparently interactive adding reads
standard input for commands and exits if EOF is given, so in:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;pstash galias; set -o noglob; ppstash galias | consume_noglob git&#39;</span>
</pre></div>
</div>
<p><code class="code docutils literal notranslate"><span class="pre">ppstash</span> <span class="pre">galias</span> <span class="pre">|</span> <span class="pre">consume_noglob</span> <span class="pre">git</span></code> will always make interactive adding exit immediatly.</p>
<p>To fix this, one would need to conditionally pipe the stash to <code class="code docutils literal notranslate"><span class="pre">git</span></code> if it exists.
Condition check can be implemented as simple function:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pipe stash Contains</span>
<span class="k">function</span><span class="w"> </span>pstashc<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>but simple inline if statement:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;pstash galias; set -o noglob; if pstashc galias; then ppstash galias | consume_noglob git; else consume_noglob git; fi&#39;</span>
</pre></div>
</div>
<p>will not work with arguments, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>g<span class="w"> </span>--version
</pre></div>
</div>
<p>so the conditional logic has to be done inside of a function.
As <code class="code docutils literal notranslate"><span class="pre">consume_noglob</span></code> already is a function I modified it to consume the stash too:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>consume_noglob_and_pstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">stash</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">command</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>pstashc<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stash</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>ppstash<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stash</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">$command</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nv">$command</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">set</span><span class="w"> </span>+o<span class="w"> </span>noglob
<span class="o">}</span>
</pre></div>
</div>
<p>so the final alias ended up being:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;pstash galias; set -o noglob; consume_noglob_and_pstash galias git&#39;</span>
</pre></div>
</div>
<p>this works with in pipes without breaking pipes and <code class="code docutils literal notranslate"><span class="pre">g</span> <span class="pre">add</span> <span class="pre">-i</span></code>.
Full code can be found at <a class="footnote-reference brackets" href="#fullcode" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="rundir" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Function to create runtime directory.</p>
</aside>
</aside>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns 0 if $1 is modifiable directory and 1 otherwise.</span>
<span class="k">function</span><span class="w"> </span>is_modifiable_directory<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span>
<span class="o">}</span>


<span class="c1"># Creates unique runtime directory: `/runtime/dir/$1-XXXXXXXXXX`,</span>
<span class="c1"># where `/runtime/dir/` is the first that exists from:</span>
<span class="c1">#</span>
<span class="c1"># - $XDG_RUNTIME_DIR</span>
<span class="c1"># - $TMPDIR</span>
<span class="c1"># - /tmp</span>
<span class="c1">#</span>
<span class="c1"># exits with status 10 if none of these is found.</span>
<span class="c1">#</span>
<span class="c1"># The path of created temporary directory is wirtten to stdout.</span>
<span class="k">function</span><span class="w"> </span>create_runtime_dir<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: no label given&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;usage: create_runtime_dir &lt;label&gt;&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span>runtime_dir
<span class="w">    </span><span class="k">if</span><span class="w"> </span>is_modifiable_directory<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$XDG_RUNTIME_DIR</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">runtime_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XDG_RUNTIME_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span>is_modifiable_directory<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TMPDIR</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">runtime_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TMPDIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span>is_modifiable_directory<span class="w"> </span><span class="s2">&quot;/tmp&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">runtime_dir</span><span class="o">=</span><span class="s2">&quot;/tmp&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: no system runtime directory found&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">10</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>mktemp<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$runtime_dir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">-XXXXXXXXXX&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fullcode" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Full code.</p>
</aside>
</aside>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>program_exists<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;the_command&gt; could not be found&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Returns 0 if $1 is modifiable directory and 1 otherwise.</span>
<span class="k">function</span><span class="w"> </span>is_modifiable_directory<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span>
<span class="o">}</span>

<span class="c1"># Creates unique runtime directory: `/runtime/dir/$1-XXXXXXXXXX`,</span>
<span class="c1"># where `/runtime/dir/` is the first that exists from:</span>
<span class="c1">#</span>
<span class="c1"># - $XDG_RUNTIME_DIR</span>
<span class="c1"># - $TMPDIR</span>
<span class="c1"># - /tmp</span>
<span class="c1">#</span>
<span class="c1"># exits with status 10 if none of these is found.</span>
<span class="c1">#</span>
<span class="c1"># The path of created temporary directory is wirtten to stdout.</span>
<span class="k">function</span><span class="w"> </span>create_runtime_dir<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>program_exists<span class="w"> </span>mktemp<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: no label given&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;usage: create_runtime_dir &lt;label&gt;&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span>runtime_dir
<span class="w">    </span><span class="k">if</span><span class="w"> </span>is_modifiable_directory<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$XDG_RUNTIME_DIR</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">runtime_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XDG_RUNTIME_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span>is_modifiable_directory<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TMPDIR</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">runtime_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TMPDIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span>is_modifiable_directory<span class="w"> </span><span class="s2">&quot;/tmp&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">runtime_dir</span><span class="o">=</span><span class="s2">&quot;/tmp&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: no system runtime directory found&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">10</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>mktemp<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$runtime_dir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">-XXXXXXXXXX&quot;</span>
<span class="o">}</span>

<span class="nv">__pipestashdir</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>create_runtime_dir<span class="w"> </span>pipestash<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Pipe stash</span>
<span class="k">function</span><span class="w"> </span>pstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: missing &lt;stashname&gt;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;usage: pstash &lt;stashname&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">stashname</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-t<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># stdin is connected to terminal,</span>
<span class="w">        </span><span class="c1"># so there is nothing to read.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>cat<span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Pipe stash Contains</span>
<span class="k">function</span><span class="w"> </span>pstashc<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span>
<span class="o">}</span>

<span class="c1"># Pop Pipe stash</span>
<span class="k">function</span><span class="w"> </span>ppstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: missing &lt;stashname&gt;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;usage: ppstash &lt;stashname&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">stashname</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$__pipestashdir</span><span class="s2">/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># No stash exits, so do nothing.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stashname</span><span class="s2">&quot;</span>
<span class="o">}</span>


<span class="c1"># Pipes pstash $1 to $2 if it exists.</span>
<span class="c1"># Disables noglob after the call.</span>
<span class="k">function</span><span class="w"> </span>consume_noglob_and_pstash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;error: &lt;pstash&gt; and &lt;command&gt; missing&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;usage: consume_noglob_and_pstash &lt;pstash&gt; &lt;command&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">stash</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">command</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>pstashc<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stash</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>ppstash<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$stash</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">$command</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nv">$command</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">set</span><span class="w"> </span>+o<span class="w"> </span>noglob
<span class="o">}</span>

<span class="nb">alias</span><span class="w"> </span><span class="nv">g</span><span class="o">=</span><span class="s1">&#39;pstash g_bash_alias; set -o noglob; consume_noglob_and_pstash g_bash_alias git&#39;</span>
</pre></div>
</div>
</section>

<div class="section ablog__blog_comments">
     
<div class="section ablog__prev-next">
  <span class="ablog__prev">
      Previous:
    
    <a href="lakos_rule_visualized.html">
      
      <span>Demystifying Lakos Rule via Visualization and How It Could Relate to Constexpr</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
      Next: 
    <a href="bash_quick_select_prompter.html">
      <span>Bash quick select prompter utility</span>
      
    </a>
    
  </span>
</div>
  
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">homepage</a></h1>









<div class="ablog-sidebar-item ablog__postcard">
   
  <h2>
     
    <span>04.04.2024</span>
    
  </h2>
  <ul>
    <div class="ablog-sidebar-item ablog__postcard2">
   
  <li id="ablog-sidebar-item author ablog__author">
    <span>
       Author: 
    </span>
     
    <a href="blog/author/miro-palmu.html">Miro Palmu</a>
      
  </li>
      
  <li id="ablog-sidebar-item tags ablog__tags">
    <span>
        Tags:  
    </span>
     
    <a href="blog/tag/blog.html">blog</a>
        
    <a href="blog/tag/bash.html">bash</a>
        
    <a href="blog/tag/shell.html">shell</a>
        
    <a href="blog/tag/noglob.html">noglob</a>
        
    <a href="blog/tag/pipe.html">pipe</a>
      
  </li>
   
</div>
  </ul>
</div>

<div class="ablog-sidebar-item ablog__tagcloud">
  <link
    rel="stylesheet"
    href="_static/ablog/tagcloud.css"
    type="text/css"
  />
  <h3><a href="blog/tag.html">Tags</a></h3>
  <ul class="ablog-cloud">
     
    <li class="ablog-cloud ablog-cloud-2">
      <a href="blog/tag/c.html">C++</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/c20.html">C++20</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/dsl.html">DSL</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-2">
      <a href="blog/tag/bash.html">bash</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-5">
      <a href="blog/tag/blog.html">blog</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/consteval.html">consteval</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/constexpr.html">constexpr</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/desing.html">desing</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/git.html">git</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/git-stash.html">git-stash</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/metaprogramming.html">metaprogramming</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/noexcept.html">noexcept</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/noglob.html">noglob</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/pipe.html">pipe</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/principle.html">principle</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/scripting.html">scripting</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-2">
      <a href="blog/tag/shell.html">shell</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/tools.html">tools</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/utility.html">utility</a>
    </li>
      
    <li class="ablog-cloud ablog-cloud-1">
      <a href="blog/tag/workflow.html">workflow</a>
    </li>
     
  </ul>
</div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Miro Palmu.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/bash_noglob_for_alias.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>